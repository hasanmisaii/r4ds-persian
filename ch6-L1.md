# درس ۱: Quarto

## ۱.۲۸ مقدمه

Quarto یک چارچوب نویسندگی یکپارچه برای علم داده است که کد شما، نتایج آن و متن شما را ترکیب می‌کند. اسناد Quarto کاملاً قابل بازتولید هستند و از ده‌ها فرمت خروجی مانند PDF، فایل‌های Word، ارائه‌ها و موارد دیگر پشتیبانی می‌کنند.

فایل‌های Quarto برای استفاده به سه روش طراحی شده‌اند:

- برای برقراری ارتباط با تصمیم‌گیرندگان، که می‌خواهند روی نتایج تمرکز کنند، نه کد پشت تحلیل.

- برای همکاری با سایر دانشمندان داده (از جمله خود آینده شما!)، که هم به نتایج شما و هم به نحوه رسیدن شما به آن‌ها (یعنی کد) علاقه‌مند هستند.

- به عنوان محیطی برای *انجام* علم داده، به عنوان یک دفترچه آزمایشگاهی مدرن که می‌توانید نه تنها آنچه را انجام داده‌اید، بلکه آنچه را که فکر می‌کردید را ثبت کنید.

Quarto یک ابزار رابط خط فرمان است، نه یک بسته R. این بدان معناست که راهنما، عموماً، از طریق `?` در دسترس نیست. در عوض، همانطور که در این فصل کار می‌کنید و در آینده از Quarto استفاده می‌کنید، باید به [مستندات Quarto](https://quarto.org) مراجعه کنید.

اگر کاربر R Markdown هستید، ممکن است فکر کنید "Quarto خیلی شبیه R Markdown به نظر می‌رسد". اشتباه نمی‌کنید! Quarto عملکرد بسیاری از بسته‌ها از اکوسیستم R Markdown (rmarkdown، bookdown، distill، xaringan و غیره) را در یک سیستم یکپارچه متحد می‌کند و همچنین آن را با پشتیبانی بومی برای چندین زبان برنامه‌نویسی مانند Python و Julia علاوه بر R گسترش می‌دهد. به نوعی، Quarto منعکس‌کننده همه چیزهایی است که از گسترش و پشتیبانی اکوسیستم R Markdown در طول یک دهه آموخته شده است.

### ۱.۱.۲۸ پیش‌نیازها

شما به رابط خط فرمان Quarto (Quarto CLI) نیاز دارید، اما نیازی به نصب یا بارگذاری صریح آن ندارید، زیرا RStudio به طور خودکار هر دو کار را در صورت نیاز انجام می‌دهد.

## ۲.۲۸ مبانی Quarto

این یک فایل Quarto است – یک فایل متنی ساده که پسوند `.qmd` دارد:

```
---
title: "Diamond sizes"
date: 2022-09-12
format: html
---

```{r}
#| label: setup
#| include: false

library(tidyverse)

smaller <- diamonds |> 
  filter(carat <= 2.5)
```

We have data about `r nrow(diamonds)` diamonds.
Only `r nrow(diamonds) - nrow(smaller)` are larger than 2.5 carats.
The distribution of the remainder is shown below:

```{r}
#| label: plot-smaller-diamonds
#| echo: false

smaller |> 
  ggplot(aes(x = carat)) + 
  geom_freqpoly(binwidth = 0.01)
```
```

این فایل شامل سه نوع مهم محتوا است:

- یک **سرصفحه YAML** (اختیاری) که توسط `---` احاطه شده است.
- **چانک‌های** کد R که توسط `````‎` احاطه شده‌اند.
- متن مخلوط با قالب‌بندی متنی ساده مانند `# heading` و `_italics_`.

شکل ۲۸.۱ یک سند `.qmd` را در RStudio با رابط دفترچه یادداشت نشان می‌دهد که کد و خروجی در آن درهم‌آمیخته است. می‌توانید هر چانک کد را با کلیک کردن روی آیکون Run (شبیه یک دکمه play در بالای چانک است) یا با فشار دادن Cmd/Ctrl + Shift + Enter اجرا کنید. RStudio کد را اجرا می‌کند و نتایج را به صورت درون‌خطی با کد نمایش می‌دهد.

اگر دوست ندارید نمودارها و خروجی‌های خود را در سند خود ببینید و ترجیح می‌دهید از پنل‌های Console و Plot در RStudio استفاده کنید، می‌توانید روی آیکون چرخ‌دنده کنار "Render" کلیک کنید و به "Chunk Output in Console" تغییر دهید، همانطور که در شکل ۲۸.۲ نشان داده شده است.

برای تولید یک گزارش کامل که شامل تمام متن، کد و نتایج باشد، روی "Render" کلیک کنید یا Cmd/Ctrl + Shift + K را فشار دهید. همچنین می‌توانید این کار را به صورت برنامه‌نویسی با `quarto::quarto_render("diamond-sizes.qmd")` انجام دهید. این کار گزارش را در پنل viewer نمایش می‌دهد همانطور که در شکل ۲۸.۳ نشان داده شده و یک فایل HTML ایجاد می‌کند.

هنگامی که سند را رندر می‌کنید، Quarto فایل `.qmd` را به **knitr** (https://yihui.org/knitr/) می‌فرستد که تمام چانک‌های کد را اجرا می‌کند و یک سند markdown جدید (`.md`) ایجاد می‌کند که شامل کد و خروجی آن است. فایل markdown تولید شده توسط knitr سپس توسط **pandoc** (https://pandoc.org) پردازش می‌شود که مسئول ایجاد فایل نهایی است. این فرآیند در شکل ۲۸.۴ نشان داده شده است. مزیت این گردش کار دو مرحله‌ای این است که می‌توانید طیف بسیار گسترده‌ای از فرمت‌های خروجی ایجاد کنید، همانطور که در فصل ۲۹ خواهید آموخت.

برای شروع با فایل `.qmd` خود، *File > New File > Quarto Document…* را در نوار منو انتخاب کنید. RStudio یک ویزارد راه‌اندازی می‌کند که می‌توانید از آن برای پر کردن فایل خود با محتوای مفید استفاده کنید که به شما یادآوری می‌کند که ویژگی‌های کلیدی Quarto چگونه کار می‌کنند.

بخش‌های زیر به جزئیات بیشتر سه جزء یک سند Quarto می‌پردازند: متن markdown، چانک‌های کد و سرصفحه YAML.

### ۱.۲.۲۸ تمرین‌ها

1. با استفاده از *File > New File > Quarto Document* یک سند Quarto جدید ایجاد کنید. دستورالعمل‌ها را بخوانید. تمرین اجرای چانک‌ها به صورت جداگانه. سپس سند را با کلیک روی دکمه مناسب و سپس با استفاده از میانبر صفحه‌کلید مناسب رندر کنید. تأیید کنید که می‌توانید کد را تغییر دهید، دوباره اجرا کنید و خروجی تغییر یافته را ببینید.

2. یک سند Quarto جدید برای هر یک از سه فرمت داخلی ایجاد کنید: HTML، PDF و Word. هر یک از سه سند را رندر کنید. خروجی‌ها چگونه متفاوت هستند؟ ورودی‌ها چگونه متفاوت هستند؟ (ممکن است برای ساخت خروجی PDF نیاز به نصب LaTeX داشته باشید - RStudio در صورت نیاز به این موضوع به شما اعلام می‌کند.)

3. با ویرایشگر بصری، یک پست وبلاگ در مورد چند واقعیت جالب درباره پنگوئن‌ها بسازید. شامل:
   - عنوان
   - مقدمه‌ای که یک یا دو پاراگراف متن باشد
   - دو بخش اول و دوم سطح
   - یک لیست گلوله‌ای
   - یک لیست شماره‌دار
   - یک تصویر با عنوان
   - یک نقل قول

   در فرآیند ساخت این پست وبلاگ، به ویرایشگر منبع تغییر دهید و دوباره به ویرایشگر بصری تغییر دهید. آنچه را که از تفاوت‌ها متوجه شدید یادداشت کنید.

## ۳.۲۸ ویرایشگر بصری

ویرایشگر بصری RStudio یک رابط WYSIWYM (what you see is what you mean – آنچه می‌بینید همان چیزی است که منظور دارید) برای نویسندگی اسناد Quarto ارائه می‌دهد. در زیر، همان سند در ویرایشگر منبع (سمت چپ) و ویرایشگر بصری (سمت راست) را می‌بینید. در قسمت بالا از هر دو نمایش‌دهنده سند، ویرایشگر منبع در سمت چپ است، و ویرایشگر بصری در سمت راست.

می‌توانید با کلیک بر روی آیکون "Visual" یا "Source" که در بالای سمت چپ ویرایشگر شما قرار دارد بین ویرایشگر منبع و بصری تغییر دهید. همچنین می‌توانید با ⌘⇧ F4 (Cmd + Shift + F4 در مک) یا Ctrl + Shift + F4 (در ویندوز/لینوکس) بین این دو حالت جابه‌جا شوید.

ویرایشگر بصری ممکن است در ابتدا کمی غیرعادی به نظر برسد، اما با مرور زمان و تمرین بیشتر، استفاده از آن راحت‌تر خواهد شد. محیط فکری گسترش یافته برای ایجاد محتوای ویرایشی برای همه چیز از فرمت‌بندی متن، درج تصاویر، جداول فراگیر، لیست‌ها، ریاضیات بلوکی و درون‌خطی، ارجاعات، فهرست‌نویسی‌ها، hyperlink‌ها و موارد دیگر امکان دسترسی آسان را فراهم می‌کند.

شما از دکمه جدید به کاربرد برای رسیدن به محدوده‌های استفاده معمول مارک‌دون استفاده می‌کنید (Insert → Citation برای افزودن یک استناد، Insert → Table برای افزودن یک جدول و غیره). اگر مشتاقانه منتظر میانبرهای صفحه‌کلید هستید، برای افزودن استناد Cmd/Ctrl + Shift + F8 یا برای افزودن جدول به Cmd/Ctrl + Alt + T کار خواهید کرد.

یکی از ویژگی‌های مفید ویرایشگر بصری، این است که در تعداد متن، آنچه نیاز دارید برای سندهایی که نوشته‌اید را ببینید، برجسته می‌کند. این می‌تواند تشخیص نیاز به تکمیل یک ویرایش بزرگ را راحت‌تر کند. شما می‌توانید در مورد بسیاری از ویژگی‌های خوب دیگر ویرایشگر بصری در https://quarto.org/docs/visual-editor/ اطلاعات بیشتری کسب کنید. و هر زمان که نیاز به تهیه فایل‌هایی برای ارجاع داشته باشید، به صفحه تقلب (cheat sheet) در https://rstudio.github.io/cheatsheets/quarto.pdf مراجعه کنید.

### ۱.۳.۲۸ تمرین‌ها

1. `quarto::quarto_render("diamond-sizes.qmd")` را دوباره اجرا کنید. چه فایل‌هایی ایجاد شدند؟

2. سند ویرایشی Quarto را ایجاد کنید و متن را اضافه کنید و سپس تشخیص دهید که لیست نمادهای خودکار در ویرایشگر بصری چقدر کار می‌کند. چه اتفاقی می‌افتد اگر خطی را با `-` یا `1.` شروع کنید؟ چه اتفاقی می‌افتد وقتی Tab یا Shift-Tab را فشار می‌دهید؟

3. تغییراتی در الگوی diamond-sizes.qmd انجام دهید و سپس سند را با استفاده از میانبر صفحه‌کلید Cmd/Ctrl + Shift + K رندر کنید. اکنون، قبل از رندر کردن سند، حالت "Render on Save" را فعال کنید. چه اتفاقی می‌افتد وقتی فایل را ذخیره می‌کنید؟

## ۴.۲۸ چانک‌های کد

برای اجرای کد در یک سند Quarto، باید یک چانک کد درج کنید. سه راه برای این کار وجود دارد:

- میانبر صفحه‌کلید Cmd + Option + I / Ctrl + Alt + I.
- آیکون "Insert" در نوار ابزار ویرایشگر.
- با تایپ دستی محدود کننده‌های چانک ```` ```{r} ```` و ```` ``` ````.

البته ما به شما توصیه می‌کنیم که میانبر صفحه‌کلید را یاد بگیرید. این به طور قابل توجهی کار شما را در درازمدت سرعت می‌بخشد!

می‌توانید همچنان با استفاده از Cmd/Ctrl + Enter همانند یک اسکریپت R، خط به خط کد را اجرا کنید. با این حال، چانک‌ها دارای دکمه‌ای برای اجرای همه کدهای قبل از چانک فعلی و همچنین اجرای کد در چانک فعلی هستند. در هنگام تولید یک گزارش طولانی‌تر، این دکمه‌ها می‌توانند زمان زیادی را صرفه‌جویی کنند.

چانک‌های کد را می‌توان با استفاده از زبان‌های دیگری غیر از R هم تولید کرد؛ جزئیات برای افزودن کد Python، Julia و سایر موارد در https://quarto.org/docs/computations/python.html در دسترس است.

### ۱.۴.۲۸ گزینه‌های چانک

خروجی چانک را می‌توان با استفاده از **گزینه‌های چانک** که در قالب بیانیه‌های خاص `#|` (اعلام‌های hashpipe) سفارشی کرد. به عنوان مثال، `echo: false` مانع از نمایش کد در خروجی نهایی می‌شود و `fig-cap: "یک نمودار زیبا"` یک عنوان شکل اضافه می‌کند.

در اینجا فهرستی از گزینه‌های چانک مهم آورده شده است، سازمان‌دهی‌شده بر اساس نوع خروجی که کنترل می‌کنند:

#### ۱.۱.۴.۲۸ ارزیابی

- `eval: false` از اجرای کد و از نتایج ظاهر شدن جلوگیری می‌کند.
این برای نمایش کد نمونه مفید است، یا برای غیرفعال کردن یک چانک بزرگ هنگام اشکال‌زدایی.

#### ۲.۱.۴.۲۸ نمایش

- `echo: false` کد را در خروجی نهایی پنهان می‌کند، اما نتایج را نشان می‌دهد. 
استفاده کنید زمانی که گزارش‌های شما برای مخاطبی است که نمی‌خواهد کد R زیربنایی را ببیند.
  
- `code-fold: true` و `code-summary: "نمایش کد"` کد را پنهان می‌کند، اما یک دکمه برای نمایش آن فراهم می‌کند.
    
- `include: false` کد را اجرا می‌کند اما نه کد و نه نتایج را نمایش نمی‌دهد.
استفاده کنید برای کد راه‌اندازی؛ `message: false` و `warning: false` مانع نمایش پیام‌ها و هشدارها در خروجی نهایی می‌شود.

#### ۳.۱.۴.۲۸ پیام‌ها و هشدارها

- `message: false` مانع نمایش پیام‌های تولیدشده توسط کد در خروجی نهایی می‌شود.
    
- `warning: false` مانع نمایش هشدارهای تولیدشده توسط کد در خروجی نهایی می‌شود.

#### ۴.۱.۴.۲۸ نتایج

- `error: true` باعث می‌شود رندر کردن سند ادامه یابد حتی اگر کد خطا بازگرداند.
این به ندرت چیزی است که می‌خواهید در نسخه نهایی گزارش خود بگنجانید، اما می‌تواند هنگام اشکال‌زدایی بسیار مفید باشد، زیرا می‌توانید در سند خود پیام خطا را نمایش دهید.
به طور پیش‌فرض، `error: false` باعث می‌شود رندر کردن ناموفق شود اگر خطایی وجود داشته باشد، که به شما کمک می‌کند مطمئن شوید هر خطایی در گزارش عمداً جاسازی شده است.

### ۲.۴.۲۸ گزینه‌های سراسری

همانطور که در تمرین‌ها کار می‌کنید، ممکن است کشف کنید که برخی از گزینه‌های پیش‌فرض اذیت‌کننده هستند. به عنوان مثال، ممکن است از نمایش پیام‌ها و هشدارها در گزارش نهایی شما پیش از این خسته شده باشید. اگر این اتفاق می‌افتد، شما می‌توانید گزینه‌های سراسری را در سرصفحه YAML به شرح زیر تنظیم کنید:

```
---
title: "My Document"
format: html
execute:
  echo: false
  warning: false
---
```

همچنین می‌توانید گزینه‌های سراسری را در هر سندی که می‌سازید بازنویسی کنید. گزینه‌هایی که در یک چانک قرار دارند به گزینه‌های پیش‌فرض تعریف‌شده در سطح سند اولویت دارند.

### ۳.۴.۲۸ کد درون‌خطی

همچنین یک روش دیگر برای جاسازی کد R در یک سند Quarto وجود دارد: مستقیماً در متن، با: `` `r` ``. این می‌تواند بسیار مفید باشد اگر می‌خواهید به جزئیات خاصی در متن خود ارجاع دهید. به عنوان مثال، در مثال diamond-sizes.qmd اعداد در این جمله با کد R محاسبه شده‌اند:

```
We have data about `r nrow(diamonds)` diamonds.
Only `r nrow(diamonds) - nrow(smaller)` are larger than 2.5 carats.
```

وقتی گزارش رندر می‌شود، نتایج این محاسبات جایگزین کد درون‌خطی می‌شوند. ما داده‌ای درباره ۵۳۹۴۰ الماس داریم. تنها ۱۲۶ الماس بزرگتر از ۲.۵ قیراط هستند.

هنگام درج اعداد در متن، `format()` دوست شماست. این به شما امکان می‌دهد جداکننده‌های هزارگان را تنظیم کنید که خواندن اعداد بزرگ را آسان‌تر می‌کند و `digits` را تنظیم کنید تا شما بتوانید مطمئن شوید که ثابت‌ترین تعداد رقم را برای درج در گزارش نشان می‌دهید. ممکن است همچنین بخواهید بسته scales را برای دسترسی به توابع دیگری برای مبدل کردن اعداد به رشته‌ها بررسی کنید.

### ۴.۴.۲۸ تمرین‌ها

1. نام‌گذاری چانک‌های کد را تمرین کنید، و از آن برای پیمایش در فایل Quarto خود، از یک چانک کد نام‌گذاری‌شده به چانک دیگر استفاده کنید.

2. یک چانک کد بدون نام، اما با گزینه‌های `echo: false` و `eval: false` تنظیم شده ایجاد کنید. سپس یک بار دیگر سند را رندر کنید و ببینید چه اتفاقی می‌افتد.

3. `fig-width` و `fig-asp` گزینه‌هایی هستند که اندازه شکل‌های تولیدشده را کنترل می‌کنند. با مقادیر مختلف این دو گزینه آزمایش کنید و ببینید چه تأثیری بر شکل‌های خروجی دارند.

## ۵.۲۸ ذخیره‌سازی (Caching)

به طور معمول، هر بار که یک سند را رندر می‌کنید، knitr از ابتدا شروع می‌کند و تمام کد را دوباره اجرا می‌کند. اگر دارای محاسبات زمان‌بر هستید، این می‌تواند دردسرساز باشد. راه‌حل این است که `cache: true` را روی چانک‌ها تنظیم کنید. هنگامی که تنظیم شده است، این باعث می‌شود knitr نتایج چانک را در یک فایل خاص‌نام‌گذاری‌شده روی دیسک ذخیره کند. در بار بعدی که فایل را رندر می‌کنید، knitr بررسی می‌کند آیا کد تغییر کرده است یا خیر. اگر تغییر نکرده باشد، نتایج ذخیره‌سازی‌شده را از دیسک بارگذاری می‌کند، به جای اجرای مجدد کد.

استراتژی ذخیره‌سازی چانک دارای محدودیت‌های مهمی است. بیشترین مشکل این است که به طور پیش‌فرض، ذخیره‌سازی فقط بر اساس کد نیست. به عنوان مثال، اگر فایل داده‌ای را که در یک چانک می‌خوانید تغییر دهید، آن چانک از نسخه ذخیره‌شده از داده‌های قدیمی استفاده خواهد کرد. می‌توانید از گزینه `cache.extra` برای اضافه کردن وابستگی‌های بیشتر استفاده کنید - این یک بازی وارد شده است.

ما به شدت توصیه می‌کنیم که در صورت امکان از ذخیره‌سازی اجتناب کنید، در عوض به دنبال راه‌های کارآمدتر برای کدنویسی باشید. به عنوان مثال، به جای خواندن مجدد یک فایل CSV بزرگ در هر بار رندر کردن، می‌توانید آن را یک بار به فرمت RDS بخوانید و ذخیره کنید (فرمت داده‌ای بومی R که سریع‌تر است)، سپس فایل RDS را در آینده بخوانید.

در کل، ذخیره‌سازی بهترین ابزار برای افزایش سرعت فرآیند رندر کردن است، اما باید از آن به دقت و فقط زمانی که واقعاً نیاز دارید استفاده کنید.

### ۱.۵.۲۸ تمرین‌ها

1. `cache: true` را روی یک چانک کد تنظیم کنید. سند را رندر کنید. سپس چانک را تغییر دهید (بدون تغییر کد) و دوباره رندر کنید. چه اتفاقی می‌افتد؟

2. می‌توانید فرض کنید که `cache: false` روی یک چانک خاص به چه معناست؟

## ۶.۲۸ عیب‌یابی

عیب‌یابی اسناد Quarto می‌تواند چالش برانگیز باشد زیرا دیگر در یک محیط تعاملی اجرا نمی‌شوید، و باید یاد بگیرید که برخی تکنیک‌های جدید را تمرین کنید. بعلاوه، اگر با R Markdown کار کرده باشید، ممکن است از تفاوت‌های ظریف بین R Markdown و Quarto گیج شوید.

بهترین استراتژی این است که به تدریج تکه‌های کد خود را به سند Quarto اضافه کنید. اگر اشتباهی کردید، کمتر کد برای بررسی وجود خواهد داشت.

اگر کدی را کشف کردید که خطا ایجاد می‌کند، یک مثال تکرارپذیر به حداقل برسید که برای حل مشکل استفاده شود؛ یعنی کد را به حداقل لازم برای بازتولید خطای خود کاهش دهید. معمولاً می‌توانید بخش‌های زیادی از کد و داده را برای کشف مشکل حذف کنید. این کار را انجام دهید و سپس در یک سند Quarto جدید تکرارپذیر آن را قرار دهید. اگر فقط یک نسخه کوچک دارید، می‌توانید مشکل را با سرعت بیشتری حل کنید.

اگر می‌خواهید به طور تعاملی یک تابع در یک سند Quarto را اشکال‌زدایی کنید، می‌توانید از `browser()` استفاده کنید. این تابع، کد شما را متوقف می‌کند و شما را وارد حالت تعاملی می‌کند که در آن می‌توانید متغیرها را بررسی کنید و کد را خط به خط اجرا کنید.

## ۷.۲۸ سرصفحه YAML

شما می‌توانید گزینه‌های سند را در سرصفحه YAML که توسط خطوط `---` محاصره شده است کنترل کنید. به عنوان مثال، فایل diamond-sizes.qmd دارای این سرصفحه است:

```
---
title: "Diamond sizes"
date: 2022-09-12
format: html
---
```

پارامترهای YAML کلیدهای جفت مقدار از جمله عنوان سند، تاریخ، فرمت خروجی و موارد دیگر را کنترل می‌کنند. شما می‌توانید فهرست کامل پارامترها را در https://quarto.org/docs/reference/formats/html.html پیدا کنید.

ما در اینجا چند پارامتر کلیدی را نشان خواهیم داد که احتمالاً بیشترین استفاده را خواهند داشت.

### ۱.۷.۲۸ پارامترها

اسناد Quarto می‌توانند شامل یک یا چند پارامتر باشند: مقادیری که هنگام رندر کردن سند تنظیم می‌شوند. پارامترها برای بازتولید یک گزارش با مجموعه‌های مختلف ورودی مفید هستند - به عنوان مثال، ممکن است بخواهید گزارش‌های فروش برای هر شعبه، رزومه امتحان برای هر دانش‌آموز یا خلاصه‌های جمعیتی برای هر کشور تولید کنید. برای اعلام یک یا چند پارامتر، از فیلد `params` در سرصفحه YAML استفاده کنید.

در اینجا نمونه‌ای از سندی است که پارامتری به نام `my_class` دارد:

```
---
title: "My Document"
params:
  my_class: "suv"
---
```

در کد و متن سند، می‌توانید به پارامتر با استفاده از `params$my_class` ارجاع دهید. به عنوان مثال:

```{r}
mpg |> filter(class == params$my_class)
```

می‌توانید سند خود را با پارامترهای جدید از طریق کنسول با استفاده از `quarto_render()` با پارامتر `execute_params` رندر کنید:

```r
quarto::quarto_render(
  "my-document.qmd",
  execute_params = list(my_class = "compact")
)
```

این بسیار مفید است اگر بخواهید چندین نسخه از یک سند را تولید کنید.

### ۲.۷.۲۸ فهرست مطالب

شما می‌توانید یک فهرست مطالب (table of contents - TOC) با گزینه `toc` اضافه کنید، و عمق سرصفحه‌هایی که در آن گنجانده می‌شود را با `toc-depth` کنترل کنید. به عنوان مثال:

```
---
title: "My Document"
format:
  html:
    toc: true
    toc-depth: 2
---
```

### ۳.۷.۲۸ شماره‌گذاری بخش‌ها

همچنین می‌توانید سرصفحه‌ها را با `number-sections: true` شماره‌گذاری کنید:

```
---
title: "My Document"
format:
  html:
    number-sections: true
---
```

### ۴.۷.۲۸ کتابشناسی و استنادها

Quarto می‌تواند استنادات را در قالب‌های مختلف مانند BibTeX، BibLaTeX، EndNote، Medline و غیره ایجاد کند. برای استفاده از استنادات، یک فایل کتابشناسی (bibliography file) را با استفاده از فیلد `bibliography` در سرصفحه YAML مشخص کنید. به عنوان مثال:

```
---
title: "My Document"
bibliography: references.bib
---
```

می‌توانید استناد را با نحو `@citation` ایجاد کنید که `citation` یک شناسه استناد در فایل کتابشناسی شماست. به عنوان مثال:

```
Separate multiple citations with a ; [@citation1; @citation2].
```

استنادات به طور خودکار در انتهای سند به عنوان یک فهرست منابع ظاهر می‌شوند.

## ۸.۲۸ گردش کار

در ابتدا، ممکن است ذهن شما به طور تعاملی در کنسول یا در اسکریپت R کار کند، سپس به Quarto منتقل شود فقط هنگامی که می‌خواهید برخی یافته‌ها را ارتباط دهید. با مرور زمان، ممکن است گردش کار شما تغییر کند تا به طور مستقیم در Quarto کار کنید. اگر Quarto برای شما جدید است، ممکن است شروع با یک اسکریپت R ساده راحت‌تر باشد، اما به تدریج شروع به انتقال به Quarto کنید.

در اینجا چند نکته برای انتقال موفق:

- به یاد داشته باشید که یک دکمه "Render" (Ctrl+Shift+K / Cmd+Shift+K) که به شما کمک می‌کند همه چیز را در یک لحظه آزمایش کنید.
- محیط کنسول و محیط Quarto مستقل هستند. اگر متغیری را در کنسول تعریف کنید، در Quarto موجود نخواهد بود و بالعکس.
- Quarto گزارش‌ها کاملاً قابل بازتولید هستند. اگر گزارش شما بدون خطا رندر می‌شود، می‌توانید مطمئن باشید که همه محاسبات صحیح است.

اگر مرتباً در یک فایل Quarto کار می‌کنید، گزینه "Render on Save" را فعال کنید تا هر بار که فایل را ذخیره کنید به طور خودکار رندر شود. این می‌تواند زمان زیادی را صرفه‌جویی کند.

همچنین ممکن است بخواهید دستورات `rm(list = ls())` را در ابتدای گزارش خود داشته باشید. این همه اشیا را در محیط فعلی حذف می‌کند که می‌تواند کمک کند اطمینان حاصل کنید که گزارش شما کاملاً قابل بازتولید است.

## ۹.۲۸ کد درون‌خطی برای عناوین

گاهی اوقات می‌خواهید کد درون‌خطی را در عنوان یک سند، یک سرصفحه یا برچسب قرار دهید. متأسفانه، Quarto اجازه نمی‌دهد که کد درون‌خطی را مستقیماً در این مکان‌ها استفاده کنید. در عوض، می‌توانید از متغیرهای YAML استفاده کنید که با استفاده از کد R در بخشی از سند تنظیم می‌شوند.

به عنوان مثال، اگر می‌خواهید عنوان سند شامل تاریخ امروز باشد، می‌توانید این کار را انجام دهید:

```
---
title: "`r format(Sys.Date(), '%B %d, %Y')`"
---
```

## ۱۰.۲۸ وابستگی‌های نرم‌افزاری

اگر کد خود را با دیگران به اشتراک می‌گذارید، آن‌ها باید بتوانند بسته‌های R مورد نیاز برای اجرای کد شما را نصب کنند. بسته renv راهی برای ایجاد یک محیط بسته قابل تکرار برای پروژه‌های R فراهم می‌کند. renv نسخه‌های خاصی از بسته‌هایی را که استفاده می‌کنید ردیابی و ضبط می‌کند و اطمینان می‌دهد که همان بسته‌ها بر روی سیستم‌های دیگر نصب شوند. می‌توانید در https://rstudio.github.io/renv/ بیشتر بیاموزید.

یک راه سریع و کثیف این است که در پایان سند خود یک چانک با `sessionInfo()` اضافه کنید. این اطلاعاتی درباره نسخه R، سیستم عامل و بسته‌های بارگذاری‌شده را چاپ می‌کند:

```{r}
sessionInfo()
```

این به شما کمک می‌کند بدانید چه نسخه‌هایی از بسته‌ها در زمان ایجاد گزارش استفاده می‌شده‌اند.

## ۱۱.۲۸ دفترچه آزمایشگاهی

همانطور که در مقدمه اشاره کردیم، اسناد Quarto می‌توانند به عنوان دفترچه آزمایشگاه مدرن استفاده شوند که در آن می‌توانید نه تنها آنچه را انجام داده‌اید، بلکه آنچه را فکر می‌کردید را ثبت کنید. دفترچه آزمایشگاهی چیزی بیش از یک مکان برای ذخیره کد است - این یک مکان برای ثبت فرآیند تفکر شماست.

بسیاری از توصیه‌های خوب درباره استفاده مؤثر از دفترچه‌های آزمایشگاه را می‌توان به دفترچه‌های تحلیل نیز ترجمه کرد. ما بر اساس تجربیات خود و توصیه‌های Colin Purrington درباره دفترچه‌های آزمایشگاه (https://colinpurrington.com/tips/lab-notebooks) نکات زیر را ارائه می‌دهیم:

- مطمئن شوید هر دفترچه عنوانی توصیفی، یک نام فایل تداعی‌کننده و یک پاراگراف اول دارد که به طور خلاصه اهداف تحلیل را توضیح می‌دهد.

- از فیلد `date` در سرصفحه YAML برای ثبت تاریخی که شروع به کار روی دفترچه کردید استفاده کنید:
  ```
  date: 2016-08-23
  ```
  از فرمت ISO8601 YYYY-MM-DD استفاده کنید تا هیچ ابهامی وجود نداشته باشد. حتی اگر معمولاً تاریخ‌ها را به این صورت نمی‌نویسید، از آن استفاده کنید!

- اگر زمان زیادی را صرف یک ایده تحلیل کردید و معلوم شد که به بن‌بست رسیده، آن را حذف نکنید! یک یادداشت کوتاه درباره دلیل شکست آن بنویسید و در دفترچه بگذارید. این به شما کمک می‌کند از رفتن به همان بن‌بست وقتی در آینده به تحلیل بازمی‌گردید جلوگیری کنید.

- به طور کلی، بهتر است ورود داده را خارج از R انجام دهید. اما اگر نیاز دارید یک قطعه کوچک داده را ثبت کنید، به وضوح آن را با استفاده از `tibble::tribble()` مشخص کنید.

- اگر خطایی در یک فایل داده کشف کردید، هرگز آن را مستقیماً تغییر ندهید، بلکه کدی بنویسید که مقدار را اصلاح کند. توضیح دهید که چرا این اصلاح را انجام دادید.

- قبل از اینکه روز کاری خود را تمام کنید، مطمئن شوید که می‌توانید دفترچه را رندر کنید. اگر از ذخیره‌سازی استفاده می‌کنید، مطمئن شوید که حافظه‌های پنهان را پاک کنید. این به شما امکان می‌دهد هر گونه مشکلی را در حالی که کد هنوز در ذهن شما تازه است، برطرف کنید.

- اگر می‌خواهید کد شما در درازمدت قابل بازتولید باشد (یعنی بتوانید ماه یا سال بعد برگردید و آن را اجرا کنید)، باید نسخه‌های بسته‌هایی را که کد شما استفاده می‌کند ردیابی کنید. یک رویکرد دقیق استفاده از renv است (https://rstudio.github.io/renv/index.html) که بسته‌ها را در دایرکتوری پروژه شما ذخیره می‌کند. یک راه سریع و کثیف این است که یک چانک اضافه کنید که `sessionInfo()` را اجرا کند - این به شما اجازه نمی‌دهد که به راحتی بسته‌های خود را همانطور که امروز هستند بازسازی کنید، اما حداقل خواهید دانست که چه بودند.

- در طول کار خود، بسیاری بسیاری از دفترچه‌های تحلیل ایجاد خواهید کرد. چگونه آن‌ها را سازماندهی می‌کنید تا بتوانید در آینده دوباره آن‌ها را پیدا کنید؟ ما توصیه می‌کنیم آن‌ها را در پروژه‌های جداگانه ذخیره کنید و یک طرح نام‌گذاری خوب ایجاد کنید.

## ۱۲.۲۸ خلاصه

در این فصل، شما را با Quarto برای نویسندگی و انتشار اسناد محاسباتی قابل بازتولید که شامل کد و متن شما در یک مکان است، آشنا کردیم. شما درباره نوشتن اسناد Quarto در RStudio با ویرایشگر بصری یا منبع، نحوه کار چانک‌های کد و چگونگی سفارشی‌سازی گزینه‌ها برای آن‌ها، نحوه گنجاندن شکل‌ها و جداول در اسناد Quarto خود و گزینه‌های ذخیره‌سازی برای محاسبات آموختید. علاوه بر این، درباره تنظیم گزینه‌های سرصفحه YAML برای ایجاد اسناد مستقل یا پارامتری و همچنین گنجاندن استنادات و کتابشناسی آموختید. ما همچنین به شما چند نکته عیب‌یابی و گردش کار دادیم.

در حالی که این مقدمه باید برای شروع کار با Quarto کافی باشد، هنوز خیلی چیزها برای یادگیری وجود دارد. Quarto هنوز نسبتاً جوان است و هنوز به سرعت در حال رشد است. بهترین مکان برای به‌روز ماندن از نوآوری‌ها وب‌سایت رسمی Quarto است: https://quarto.org

دو موضوع مهم وجود دارد که ما در اینجا پوشش نداده‌ایم: همکاری و جزئیات انتقال دقیق ایده‌های خود به سایر انسان‌ها. همکاری بخش حیاتی علم داده مدرن است و می‌توانید زندگی خود را با استفاده از ابزارهای کنترل نسخه مانند Git و GitHub بسیار آسان‌تر کنید. ما "Happy Git with R" را توصیه می‌کنیم، یک مقدمه کاربرپسند برای Git و GitHub از کاربران R، توسط Jenny Bryan. این کتاب به صورت رایگان آنلاین در دسترس است: https://happygitwithr.com

ما همچنین به آنچه واقعاً باید بنویسید تا نتایج تحلیل خود را به وضوح منتقل کنید، نپرداخته‌ایم. برای بهبود نوشتار خود، ما به شدت توصیه می‌کنیم خواندن "Style: Lessons in Clarity and Grace" نوشته Joseph M. Williams & Joseph Bizup، یا "The Sense of Structure: Writing from the Reader's Perspective" نوشته George Gopen. هر دو کتاب به شما کمک می‌کنند ساختار جملات و پاراگراف‌ها را درک کنید و ابزارهایی برای واضح‌تر کردن نوشتار خود به شما می‌دهند. (این کتاب‌ها در صورت خرید جدید نسبتاً گران هستند، اما در بسیاری از کلاس‌های انگلیسی استفاده می‌شوند بنابراین نسخه‌های دست دوم ارزان فراوانی وجود دارد). George Gopen همچنین تعدادی مقاله کوتاه درباره نوشتار در https://www.georgegopen.com/litigation-articles.html دارد. آن‌ها برای وکلا هستند، اما تقریباً همه چیز برای دانشمندان داده نیز کاربرد دارد.
