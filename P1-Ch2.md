# جریان کاری: اصول پایه

حالا کمی در اجرای کدهای R تجربه پیدا کرده‌اید. ما جزئیات زیادی در اختیار شما قرار ندادیم، اما مشخص است که شما اصول پایه را یاد گرفته‌اید چون در غیر این صورت احتمالاً این کتاب را با نااَمیدی کنار می‌گذاشتید!
احساس ناامیدی زمانی که شما برنامه‌نویسی در R را شروع می‌کنید، کاملاً طبیعی است، زیرا این زبان روی نشانه‌گذاری بسیار سخت‌گیر است و حتی جابه‌جایی یک کاراکتر می‌تواند باعث خطا شود.
هرچند باید انتظار اندکی کلافگی داشته باشید، اما آسوده باشید زیرا چنین تجربه‌ای رایج و موقتی است. این موضوع برای همه اتفاق می‌افتد و تنها راه غلبه بر آن این است که به تلاش کردن ادامه دهید.
پیش از ادامه، بیایید مطمئن شویم که شما مبانی اجرای کدهای R را به‌خوبی فرا گرفته‌اید و با برخی از امکانات مفید نرم‌افزار RStudio آشنا شده‌اید.

## مبانی کدنویسی

بیایید برخی از اصول پایه را مرور کنیم که تا پیش‌ از این برای این‌که بتوانید سریع‌تر نمودارها را ترسیم کنید، نادیده گرفته‌ بودیم. شما می‌توانید از R برای انجام محاسبات ریاضیاتی ساده استفاده کنید:
```{r}
1 / 200 * 30
#> [1] 0.15
(59 + 73 + 2) / 3
#> [1] 44.66667
sin(pi / 2)
#> [1] 1
```
می‌توانید با استفاده از عملگر انتساب <span dir="ltr"><-</span> اشیای جدید ایجاد کنید.
```{r}
x <- 3 * 4
```
توجه داشته باشید که مقدار x چاپ نمی‌شود، بلکه فقط ذخیره می‌گردد. اگر بخواهید مقدار آن را مشاهده کنید، کافی است x را در کنسول تایپ کنید.

هم‌چنین می‌توانید چندین عنصر را با استفاده از تابع <span dir="ltr">c()</span> در قالب یک بردار ترکیب کنید.
```{r}
primes <- c(2, 3, 5, 7, 11, 13)
```
و محاسبات ریاضیاتی پایه روی بردار، بر تک‌تک عناصر آن اعمال می‌شود.
```{r}
primes * 2
#> [1] 4 6 10 14 22 26
primes - 1
#> [1] 1 2 4 6 10 12
```
تمام دستورات R ای که در آن‌ها شیء ایجاد می‌کنید *- یعنی دستورات انتساب -* ساختاری یکسان دارند.
```{r}
object_name <- value
```
هنگام خواندن کد بالا، در ذهن خود بگویید «متغیر <span dir="ltr">object_name</span>، مقدار <span dir="ltr">value</span> را دریافت می‌کند».

در آینده انتساب‌های زیادی انجام خواهید داد و هر بار نوشتن <span dir="ltr"><-</span> ممکن است عذاب‌آور باشد. 
می‌توانید با ‌کلید میان‌بُرِ RStudio یعنی <span dir="ltr">Alt + -</span>
در زمان صرفه‌جویی کنید. توجه داشته باشید که RStudio به‌طور خودکار اطراف <span dir="ltr"><-</span> فاصله قرار می‌دهد که این یک شیوه‌ی مناسب در قالب‌بندی کد است. خواندن کد حتی در بهترین شرایط می‌تواند دشوار باشد، بنابراین «برایراحتیچشمهایتان» از فاصله‌ها استفاده کنید.
توضیحات
## توضیحات <span dir="ltr">(Comments)</span>
<span dir="ltr">R</span>
در یک خط، هر متنی را که پس از علامت # بیاید نادیده می‌گیرد. این ویژگی به شما اجازه می‌دهد «*توضیحاتی*» بنویسید؛ متنی که <span dir="ltr">R</span>، آن را نادیده می‌گیرد اما انسان‌ها آن را می‌خوانند. گاهی متوضیحاتی» می‌نویسیم تا مشخص کنیم در کد چه اتفاقی می‌افتد.

«توضیحات» می‌توانند برای شرح کوتاهی از عملکرد کد بسیار مفید باشند.
```{r}
# create vector of primes
primes <- c(2, 3, 5, 7, 11, 13)
# multiply primes by 2
primes * 2
#> [1] 4 6 10 14 22 26
```
نوشتن «توضیح» برای هر خط از کد در قطعه‌کدهای کوتاه شاید ضروری نباشد. اما هرچه کد پیچیده‌تر شود، نوشتن «توضیحات» برای درک آن‌چه که در کد انجام شده است می‌تواند زمان زیادی برای شما و همکاران‌تان 
صرفه‌جویی کند.

از «توضیحات» برای بیان «چرایی» کدهای خود استفاده کنید نه برای شرح «چگونگی» یا «آنچه» کد انجام می‌دهد. این که کد شما «چه» کار می‌کند؟ و آن را «چطور» انجام می‌دهد؟ با دقت در خواندن کد، حتی اگر زمان‌بر باشد، همیشه قابل درک است. 
اگر هر مرحله از کد را در «توضیحات» شرح دهید و سپس کد را تغییر دهید، باید به‌روز کردن «توضیحات» آن را هم به یاد داشته باشید در غیر این صورت در آینده هنگام بازگشت به کدهایتان، برایتان گیج‌کننده خواهد بود.

فهمیدن «چرایی» کاری که انجام شده است، بسیار دشوارتر است اگر غیرممکن نباشد. برای مثال تابع
<span dir="ltr">geom_smooth()</span>
آرگومانی به نام  <span dir="ltr">span</span>  دارد که میزان هموار بودن منحنی را کنترل می‌کند. هرچه مقدار آن بزرگ‌تر باشد، منحنی هموارتر خواهد شد. حال فرض کنید تصمیم می‌گیرید مقدار <span dir="ltr">span</span> را از مقدار پیش‌فرض ۰٫۷۵ به ۰٫۹ تغییر دهید: برای خواننده‌ی آتی به‌راحتی قابل درک است که «چه چیزی» در حال رخ دادن است، اما اگر در یک «توضیح» دلیل تغییر مقدار پیش‌فرض را ننویسید، هیچ‌کس «چرایی» این تغییر را نخواهد فهمید.
 
برای کدهای تحلیل داده‌ها، از «توضیحات» برای شرح طرح کلی رویکرد خود استفاده کنید و هنگام مواجهه با آن‌ها، نکات مهم را ثبت کنید. این دانش را به هیچ‌وجه نمی‌توان صرفاً از خود کد دوباره به دست آورد.

## در یک «نام» چی هست؟

نام اشیا باید با یک حرف آغاز شود و تنها می‌تواند شامل حروف، اعداد، «\_» و «.» باشد. اگر شما می‌خواهید اسم اشیا‌‌ء توصیفی باشد بنابراین برای توصیف چندین واژه باید یک قاعده مشخص را در پیش بگیرید. توصیه ما روش 
*<span dir="ltr">snake_case</span>*
 است که در آن  کلمات (با حروف کوچک انگلیسی) با علامت \_ از هم جدا می‌شوند.
```{r}
i_use_snake_case
otherPeopleUseCamelCase
some.people.use.periods
And_aFew.People_RENOUNCEconvention
```
در فصل ۴ زمانی که درباره سبک کدنویسی بحث کنیم، دوباره به «نام‌ها» بازخواهیم گشت.

می‌توانید یک شیء را با نوشتن نام آن مشاهده و بررسی کنید:
```{r}
x
#> [1] 12
```
انتساب دیگری ایجاد کنید:
```{r}
this_is_a_really_long_name <- 2.5
```
برای بررسی و مشاهده این شیء، از قابلیت تکمیل خودکار نرم‌افزار RStudio استفاده کنید. عبارت «this» را بنویسید، کلید Tab را فشار دهید، کاراکترها را تا زمانی که پیشوند منحصربه‌فردی داشته باشید اضافه کنید، سپس کلید Enter را فشار دهید.

فرض کنیم اشتباه می‌کنید و مقدار متغیر this_is_a_really_long_name به جای ۲٫۵ باید ۳٫۵ باشد. برای اصلاح آن می‌توانید از کلید میان‌بُر دیگری استفاده کنید. برای مثال، می‌توانید کلید جهت بالا «↑» را فشار دهید تا آخرین دستوری که نوشتید، ظاهر شود و آن را ویرایش کنید یا عبارت «this» را نوشته و سپس کلید‌های 
<span dir="ltr">Ctrl + ↑</span>
 را فشار دهید تا لیستی از تمام دستورات نوشته شده‌ای که با آن حروف شروع می‌شوند نمایش داده شود. با کلیدهای جهت‌دار در میان گزینه‌ها حرکت کرده و کلید Enter را فشار دهید تا دستور دوباره نوشته شود. مقدار ۲٫۵ را به ۳٫۵ تغییر دهید و کد را دوباره اجرا کنید.

انتساب دیگری ایجاد کنید:
```{r}
r_rocks <- 2^3
```
بیایید آن را مشاهده و بررسی کنیم:
```{r}
r_rock
#> Error: object 'r_rock' not found
R_rocks
#> Error: object 'R_rocks' not found
```
این موضوع، قرارداد ضمنی بین شما و نرم افزار R را نشان می‌دهد. R محاسبات زمان‌بر را برای شما انجام می‌دهد، در عوض شما باید در دستورات خود کاملاً دقیق باشید. در غیر این صورت، احتمالاً با خطایی مواجه می‌شوید که می‌گوید شیء مورد نظر یافت نشد.

اشتباهات تایپی مهم هستند؛ نرم‌افزار R نمی‌تواند ذهن شما را بخواند و بگوید: «اوه، احتمالاً منظورشان r_rocks بوده وقتی r_rock تایپ کرده‌اند.»

حروف بزرگ و کوچک مهم هستند؛ به همین ترتیب، R نمی‌تواند ذهن شما را بخواند و بگوید: «احتمالاً منظورشان r_rocks بوده وقتی R_rocks تایپ کرده‌اند.»

## فراخوانی توابع

نرم افزار R مجموعه بزرگی از توابع داخلی دارد که به شکل زیر فراخوانی می‌شوند
```{r}
function_name(argument1 = value1, argument2 = value2, ...)
```
بیایید از تابع <span dir="ltr">seq()</span> که *دنباله‌های* منظم اعداد را ایجاد می‌کند، استفاده کنیم و در همین حال نیز برخی امکانات مفید نرم‌افزار RStudio  را یاد می‌گیریم. عبارت se را نوشته و کلید Tab را فشار دهید. یک پنجره بازشو، تمام پیشنهادهای تکیمل خودکار ممکن را به شما نمایش می‌دهد. برای مشخص کردن تابع <span dir="ltr">seq()</span>، می‌توانید حروف بیشتری (مثل q و a) بنویسید تا ابهام (در نام تابع) رفع شود یا با کلیدهای <span dir="ltr">↑/↓</span> یکی از توابع را انتخاب کنید. به پیام راهنمای شناوری که ظاهر می‌شود، توجه کنید. این پیام، هدف و آرگومان‌های تابع را یادآوری می‌کند. اگر به کمک بیشتری نیاز دارید، کلید F1 را فشار دهید تا تمام جزئیات مربوطه در برگه‌ی راهنما واقع در بخش سمت راست و پایین پنجره‌ی نرم‌افزار RStudio نمایش داده شود.

پس از انتخاب تابع دلخواه‌تان، دوباره کلید Tab را فشار دهید. نرم‌افزار RStudio یک جفت پرانتز (باز و بسته) را برای شما اضافه می‌کند. نام اولین آرگومان یعنی <span dir="ltr">from</span> را نوشته و مقدار آن را برابر با ۱، سپس نام دومین آرگومان یعنی <span dir="ltr">to</span> را نوشته و مقدار آن را برابر ۱۰ قرار دهید. در نهایت، کلید Enter را بزنید.
```{r}
seq(from = 1, to = 10)
#> [1] 1 2 3 4 5 6 7 8 9 10
```
ما اغلب در فراخوانی توابع، نام چند آرگومان ابتدایی را حذف می‌کنیم، بنابراین می‌توانیم این کد را به شکل زیر بازنویسی کنیم:
```{r}
seq(1, 10)
#> [1] 1 2 3 4 5 6 7 8 9 10
```
کد زیر را تایپ کنید و متوجه کمک مشابه نرم‌افزار RStudio در مورد گیومه‌ها می‌شوید.
```{r}
x <- "hello world"
```
گیومه‌ها و پرانتزها همیشه باید به صورت جفت بیایند. نرم‌افزار RStudio تا حد امکان به شما کمک می‌کند، اما کماکان ممکن است اشتباه کنید و با ناهماهنگی مواجه شوید. اگر چنین اتفاقی بیفتد، نرم‌افزار R «کاراکتر ادامه دستور» یعنی + را نمایش خواهد داد:
```{r}
> x <- "hello
+
```
علامت + نشان می‌دهد که نرم‌افزار R  منتظر ورودی بیشتری است و فکر می‌کند که شما هنوز کارتان تمام نشده است. معمولاً این موضوع به این معناست که یا یک " را فراموش کرده‌اید یا یک <span dir="ltr">)</span>. در این حالت یا جفت گمشده را اضافه کنید یا برای لغو اجرای عبارت، کلید Esc را فشار دهید و دوباره تلاش کنید.

توجه داشته باشید که برگه Environment در بخشِ سمت راست و بالای پنجره نرم‌افزار RStudio، تمام اشیایی را که ایجاد کرده‌اید، نمایش می‌دهد.

![The data science process](images/rstudio-env.png)

## تمرین‌ها

۱. چرا این کد کار نمی‌کند؟
```{r}
my_variable <- 10
my_varıable
#> Error in eval(expr, envir, enclos): object 'my_varıable' not found
```
با دقت به کد نگاه کنید! (این تمرین در ظاهر ممکن است بی‌هدف به نظر برسد، اما تمرین ذهن‌تان برای توجه به کوچک‌ترین تفاوت‌ها هنگام برنامه‌نویسی برایتان بسیار مفید است.)

۲. هر یک از دستورات R زیر را ویرایش کنید تا به درستی اجرا شوند:
```{r}
libary(todyverse)

ggplot(dTA = mpg) +
geom_point(maping = aes(x = displ y = hwy)) +
geom_smooth(method = "lm)
```
۳. کلیدهای <span dir="ltr"> Option+Shift+K  / Alt+Shift+K</span> را فشار دهید. چه اتفاقی می‌افتد؟ چگونه می‌توانید با استفاده از منوها به همان بخش برسید؟

۴. بیایید دوباره به تمرینی از بخش «نمودارهایتان را ذخیره کنید» در صفحه ۳۰ نگاهی بیندازیم. کدهای زیر را اجرا کنید. کدام یک از دو نمودار به‌عنوان mpg-plot.png ذخیره می‌شود؟ چرا؟
```{r}
my_bar_plot <- ggplot(mpg, aes(x = class)) +
geom_bar()
my_scatter_plot <- ggplot(mpg, aes(x = cty, y = hwy)) +
geom_point()
ggsave(filename = "mpg-plot.png", plot = my_bar_plot)
```

## خلاصه

حالا که کمی بیشتر درباره شیوه کارکرد کدهای R آموخته‌اید و نکاتی برای درک بهتر کد هنگام بازگشت به آن در آینده دریافت کرده‌اید، در فصل بعد با آموزش dplyr به سفرتان در علم داده ادامه می‌دهیم، بسته‌ی «<span dir="ltr">tidyverse</span>»، چه با انتخاب متغیرهای مهم، چه فیلتر کردن ردیف‌های موردنظر یا محاسبه آماره‌های خلاصه، به شما در تبدیل و تغییر داده‌ها کمک می‌کند. 
