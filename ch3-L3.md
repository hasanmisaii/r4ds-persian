# ۱۴ رشته‌ها

## ۱.۱۴ مقدمه

تا به حال یاد گرفتید که چگونه با اعداد و بردارهای منطقی کار کنید، که نسبتاً ساده هستند زیرا اعداد و مقادیر `TRUE` و `FALSE` قابل‌فهم هستند. اما حقیقت این است که زندگی اغلب شامل رشته‌ها است، که می‌توانند ترکیب دلخواهی از کاراکترها باشند. این فصل به شما ابزارهای لازم برای کار با رشته‌ها در R را می‌دهد.

ما با جزئیات ایجاد رشته‌ها و نحوه ترکیب آن‌ها با دست شروع می‌کنیم. سپس به عمق بیشتری از عملکردهای stringr می‌پردازیم که به شما اجازه می‌دهند کاراکترهای منفرد را استخراج کنید، طول رشته را پیدا کنید و رشته‌ها را دستکاری کنید. در پایان، عبارات منظم (regular expressions) را معرفی خواهیم کرد، ابزار قدرتمندی برای استخراج الگوها از رشته‌ها. ما با بررسی توابع دیگر stringr که از عبارات منظم استفاده می‌کنند به پایان می‌رسیم.

### ۱.۱.۱۴ پیش‌نیازها

در این فصل، بر روی توابع رشته‌ای از stringr تمرکز خواهیم کرد. stringr بخشی از tidyverse اصلی نیست زیرا شما نیازی به آن برای هر تحلیل ندارید، بنابراین باید آن را به‌طور صریح بارگذاری کنید.

```{r}
#| label: setup
#| message: false
library(tidyverse)
library(stringr)
```

## ۲.۱۴ مبانی رشته

می‌توانید رشته‌هایی را با علامت‌نقل تک (`'`) یا علامت‌نقل دوتایی (`"`) ایجاد کنید. هیچ تفاوتی در رفتار بین آن دو وجود ندارد، بنابراین در اکثر موارد یک مورد را انتخاب کنید و با آن ثابت بمانید. اگر رشته شما حاوی علامت‌نقل دوتایی باشد، آن را با علامت‌نقل تک احاطه کنید و برعکس:

```{r}
string1 <- "This is a string"
string2 <- 'To put a "quote" inside a string, use single quotes'
```

اگر هر دوی علامت‌نقل تک و دوتایی را درون رشته‌تان نیاز دارید، می‌توانید از `\` برای "فرار" (escape) استفاده کنید:

```{r}
double_quote <- "\"" # or '"'
single_quote <- '\'' # or "'"
```

### ۱.۲.۱۴ چندین رشته

می‌توانید چندین رشته را در یک بردار کاراکتری ذخیره کنید، که می‌توانید با `c()` ایجاد کنید:

```{r}
x <- c("one", "two", "three")
```

### ۲.۲.۱۴ طول

تعداد کاراکترها در یک رشته را می‌توانید با استفاده از `str_length()` بدست آورید:

```{r}
str_length(x)
#> [1] 3 3 5
```

### ۳.۲.۱۴ ترکیب

برای ترکیب دو یا چند رشته، از `str_c()` استفاده کنید:

```{r}
str_c("x", "y")
#> [1] "xy"
str_c("x", "y", "z")
#> [1] "xyz"
```

از آرگومان `sep` برای کنترل نحوه جداسازی آن‌ها استفاده کنید:

```{r}
str_c("x", "y", sep = ", ")
#> [1] "x, y"
```

مانند بیشتر توابع دیگر در R، مقادیر گمشده عفونی هستند. اگر می‌خواهید آن‌ها را به عنوان `"NA"` چاپ کنید، از `str_replace_na()` استفاده کنید:

```{r}
x <- c("abc", NA)
str_c("|-", x, "-|")
#> [1] "|-abc-|" NA       
str_c("|-", str_replace_na(x), "-|")
#> [1] "|-abc-|" "|-NA-|"
```

### ۴.۲.۱۴ زیررشته‌ها

می‌توانید با استفاده از `str_sub()` قسمت‌هایی از رشته را استخراج کنید. علاوه بر رشته، `str_sub()` آرگومان‌های `start` و `end` را می‌گیرد که موقعیت شروع و پایان را مشخص می‌کنند (شامل):

```{r}
x <- c("Apple", "Banana", "Pear")
str_sub(x, 1, 3)
#> [1] "App" "Ban" "Pea"
```

می‌توانید از اعداد منفی برای شمارش از انتهای رشته استفاده کنید:

```{r}
str_sub(x, -3, -1)
#> [1] "ple" "ana" "ear"
```

## ۳.۱۴ عبارات منظم

عبارات منظم ابزار قدرتمندی هستند که به شما امکان می‌دهند الگوهای خاصی در رشته‌ها را توصیف کنید. این الگوها می‌توانند برای جستجو، استخراج، جایگزینی یا تقسیم رشته‌ها استفاده شوند.

### ۱.۳.۱۴ الگوهای پایه

ساده‌ترین الگوها، رشته‌های دقیق هستند:

```{r}
x <- c("apple", "banana", "pear")
str_view(x, "an")
#> [2] │ b<an><an>a
```

مرحله بعد در پیچیدگی استفاده از `.` است که با هر کاراکتری (به جز خط جدید) مطابقت دارد:

```{r}
str_view(x, ".a.")
#> [2] │ <ban>ana
```

### ۲.۳.۱۴ کلاس‌های کاراکتر

کلاس‌های کاراکتری به شما امکان می‌دهند مجموعه‌ای از کاراکترها را مطابقت دهید. برای مثال، `[abc]` با a، b یا c مطابقت دارد:

```{r}
str_view(x, "[ae]")
#> [1] │ <a>ppl<e>
#> [2] │ b<a>n<a>n<a>
#> [3] │ p<e><a>r
```

### ۳.۳.۱۴ تکرار

الگوهای زیر کنترل می‌کنند که یک الگو چند بار مطابقت دارد:

- `?`: 0 یا 1 بار
- `+`: 1 یا بیشتر بار
- `*`: 0 یا بیشتر بار

```{r}
x <- "1888 is the longest year in Roman numerals: MDCCCLXXXVIII"
str_view(x, "CC+")
#> [1] │ 1888 is the longest year in Roman numerals: MD<CCC>LXXXVIII
```

همچنین می‌توانید تعداد دقیق مطابقت‌ها را مشخص کنید:

- `{n}`: دقیقاً n بار
- `{n,}`: n یا بیشتر بار
- `{n,m}`: بین n و m بار

```{r}
str_view(x, "C{2,3}")
#> [1] │ 1888 is the longest year in Roman numerals: MD<CCC>LXXXVIII
```

### ۴.۳.۱۴ لنگرها

به‌طور پیش‌فرض، عبارات منظم با هر قسمتی از رشته مطابقت می‌کنند. اغلب مفید است اگر بتوانیم عبارت منظم را به ابتدا یا انتهای رشته لنگر بزنیم:

- `^` با ابتدای رشته مطابقت دارد
- `$` با انتهای رشته مطابقت دارد

```{r}
x <- c("apple", "banana", "pear")
str_view(x, "^a")
#> [1] │ <a>pple
str_view(x, "a$")
#> [2] │ banan<a>
```

## ۴.۱۴ استخراج الگوها

### ۱.۴.۱۴ `str_detect()`

`str_detect()` یک بردار منطقی برمی‌گرداند که `TRUE` است اگر الگو در رشته یافت شود:

```{r}
x <- c("apple", "banana", "pear")
str_detect(x, "e")
#> [1]  TRUE FALSE  TRUE
```

می‌توانید از `str_detect()` با `filter()` استفاده کنید:

```{r}
#| eval: false
flights |> 
  filter(str_detect(dest, "^H"))
```

### ۲.۴.۱۴ `str_count()`

`str_count()` تعداد مطابقت‌ها را شمارش می‌کند:

```{r}
x <- c("apple", "banana", "pear")
str_count(x, "a")
#> [1] 1 3 1
```

### ۳.۴.۱۴ `str_extract()`

برای استخراج متن واقعی مطابقت، از `str_extract()` استفاده کنید:

```{r}
x <- c("apple", "banana", "pear")
str_extract(x, "[aeiou]")
#> [1] "a" "a" "e"
```

`str_extract()` فقط اولین مطابقت را استخراج می‌کند. برای دریافت همه مطابقت‌ها، از `str_extract_all()` استفاده کنید:

```{r}
str_extract_all(x, "[aeiou]")
#> [[1]]
#> [1] "a" "e"
#> 
#> [[2]]
#> [1] "a" "a" "a"
#> 
#> [[3]]
#> [1] "e" "a"
```

## ۵.۱۴ جایگزینی الگوها

### ۱.۵.۱۴ `str_replace()`

`str_replace()` اولین مطابقت را جایگزین می‌کند و `str_replace_all()` همه مطابقت‌ها را جایگزین می‌کند:

```{r}
x <- c("apple", "pear", "banana")
str_replace(x, "[aeiou]", "-")
#> [1] "-pple"  "p-ar"   "b-nana"
str_replace_all(x, "[aeiou]", "-")
#> [1] "-ppl-"  "p--r"   "b-n-n-"
```

## ۶.۱۴ تقسیم رشته‌ها

از `str_split()` برای تقسیم یک رشته به قطعات استفاده کنید:

```{r}
x <- "This is a sentence"
str_split(x, " ")
#> [[1]]
#> [1] "This"     "is"       "a"        "sentence"
```

## ۷.۱۴ سایر توابع

### ۱.۷.۱۴ `str_to_lower()`, `str_to_upper()`, `str_to_title()`

این توابع حروف را تبدیل می‌کنند:

```{r}
x <- "I like R"
str_to_lower(x)
#> [1] "i like r"
str_to_upper(x)
#> [1] "I LIKE R"
str_to_title(x)
#> [1] "I Like R"
```

### ۲.۷.۱۴ `str_trim()`

`str_trim()` فضای خالی را از ابتدا و انتهای رشته حذف می‌کند:

```{r}
x <- "  String with trailing and leading white space\t"
str_trim(x)
#> [1] "String with trailing and leading white space"
```

### ۳.۷.۱۴ `str_pad()`

`str_pad()` رشته‌ها را به عرض ثابتی پد می‌کند:

```{r}
x <- c("a", "abc", "abcdef")
str_pad(x, 10)
#> [1] "         a" "       abc" "    abcdef"
str_pad(x, 10, side = "right")
#> [1] "a         " "abc       " "abcdef    "
str_pad(x, 10, side = "both")
#> [1] "    a     " "   abc    " "  abcdef  "
```

## ۸.۱۴ خلاصه

در این فصل، مهارت‌های اساسی برای کار با رشته‌ها در R را یاد گرفتید. شما یاد گرفتید چگونه رشته‌ها را ایجاد، ترکیب و دستکاری کنید. همچنین با عبارات منظم آشنا شدید، ابزار قدرتمندی برای توصیف الگوهای متنی. در نهایت، توابع stringr را یاد گرفتید که از عبارات منظم برای جستجو، استخراج و جایگزینی الگوها استفاده می‌کنند.

کار با رشته‌ها می‌تواند پیچیده باشد، اما با تمرین و استفاده از ابزارهای مناسب، می‌توانید تقریباً هر عملیات مبتنی بر متن را انجام دهید. در فصل‌های بعدی، این مهارت‌ها را در زمینه‌های واقعی‌تر مانند تحلیل داده‌های متنی و وب اسکرپینگ به کار خواهید برد.
