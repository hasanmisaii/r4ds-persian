# 2 گردش کار: اصول اولیه
اکنون شما کمی تجربه‌ی اجرای کدهای R را دارید. ما جزئیات زیادی به شما ندادیم، اما بدیهی است که اصول اولیه را فهمیده‌اید، وگرنه این کتاب را با ناامیدی به گوشه‌ای پرت می‌کردید! در زمان شروع برنامه‌نویسی در R ناامیدی طبیعی است چرا که به علائم نگارشی حساس است و حتی یک کاراکتر نابجا باعث خطا خواهد شد. زمانی که انتطار کمی ناامیدی را دارید،  سعی کنید آرام باشید چرا که ناامیدی تجربه عادی و گذرا است: این تجربه برای هر کسی اتفاق می‌افتد و تنها راه غلبه بر آن تلاش پیوسته است.

پیش از ادامه دادن، اجازه بدهید مطمئن شویم که پایه محکمی در اجرای کدهای R دارید و برخی از مفیدترین ویژگی‌های Rstudio را می‌دانید.

## 1.2 کدنویسی مقدماتی
بیایید برخی از اصول اولیه‌ای را که به دلیل ترسیم نمودار جا انداخته بودیم، مرور کنیم. می‌توانید از R برای انجام محاسبات ساده ریاضی استفاده کنید:
```{r}
1 / 200 * 30
#> [1] 0.15
(59 + 73 + 2) / 3
#> [1] 44.66667
sin(pi / 2)
#> [1] 1
```
شئ‌های جدید می‌توانند با عملگر تخصیص
`->`
ایجاد گردند:
```{r}
x <- 3 * 4
```
توجه داشته باشید که مقدار `x` نمایش داده نخواهد شد و فقط ذخیره شده است. برای نمایش مقدار ذخیره‌شده، `x` را در کنسول تایپ کنید.

می‌توانید مقادیر مختلف را درون یک بردار با
`()c`
قرار دهید:
```{r}
primes <- c(2, 3, 5, 7, 11, 13)
```
حساب‌های ساده ریاضی بر روی بردارها برای هر مقداری از بردار اعمال می‌گردد:
```{r}
primes * 2
#> [1]  4  6 10 14 22 26
primes - 1
#> [1]  1  2  4  6 10 12
```
تمامی دستورات R که با عملگر تخصیص ایجاد شده‌اند، شکل یکسانی دارند:
```{r}
object_name <- value
```

زمانی که کد خوانده می شود، به صورت «نام شی مقدار را ذخیره کن» تفسیر می‌گردد.

عملگرهای تخصیصی زیادی ایجاد خواهید کرد و تایپ
`->`
کمی پردردسر است. با میانبر صفحه کلید  Rstudio می‌توانید در زمان صرفه‌جویی کنید: Alt +- (علامت منفی). توجه کنید که Rstudio به طور خودکار عملگر
`->`
را با فضای خالی (فاصله) در دو طرف ایجاد می‌کند که یک روش خوب برای قالب‌بندی کد است. خواندن کد در یک روز خوب می‌تواند رنج‌آور باشد، پس بهچشمانتاناستراحتدهید و از فاصله استفاده کنید.

## 2.2 توضیحات
در R هر متنی پس از `#` در آن خط نادیده گرفته می‌شود. این کاراکتر اجازه می‌دهد **توضیحات** پس از آن نوشته شوند، متنی که توسط R نادیده گرفته می‌شود اما توسط دیگر افراد خوانده می‌شود. گاهی وقت‌‌ها توضیحات در بعضی مثال‌ها گنجانده  شده است که نشان می‌دهد آن کد در حال انجام چه کاری است.

توضیحات می‌توانند با ارائه توصیف مختصر برای مثال برای کد زیر سودمند باشند.
```{r}
# create vector of primes
primes <- c(2, 3, 5, 7, 11, 13)

# multiply primes by 2
primes * 2
#> [1]  4  6 10 14 22 26
```
با تکه کدهای کوتاه مانند این، نوشتن توضیح برای هر خط از کد ضروری به نظر نمی‌رسد. اما در زمان نوشتن کدهای پیچیده، توضیحات می‌توانند در زمان شما (و همکارانتان) برای فهمیدن اینکه در کد چه کاری انجام شده است، صرفه‌جویی زیادی کنند.

از توضیحات برای شرح چرایی کدهایتان و نه چگونگی آن‌ها استفاده کنید. همیشه با بررسی با دقت کدها می‌توان فهمید که کد شما چیست و چگونه نوشته شده است، حتی اگر این کار خسته‌کننده باشد. اگر هر گام از کارتان را با توضیحات توصیف کنید، در زمان تغییر کدهایتان مجبور خواهید شد که توضیحات را نیز به‌روزرسانی کنید یا وقتی که در آینده به این کدها برمی‌گردید، آنها کمی گمراه‌کننده خواهند بود.

فهمیدن چرایی انجام یک کار در یک کد بسیار دشوارتر است، اگر غیرممکن نباشد. برای مثال `()geom_smooth` دارای آرگومانی به نام `span` است به طوری که همواری یک منحنی را کنترل می‌کند و مقادیر بزرگتر منحنی هموارتری را حاصل می‌دهد. فرض کنید تصمیم گرفته‌اید مقدار پیش‌فرض `span` را از 0.75 به 0.9 تغییر دهید: در آینده برای یک خواننده فهمیدن این که چه چیزی در حال اتفاق افتادن است، آسان خواهد بود، مگر این که شما به اندیشه پشت توضیحات خود توجه داشته باشید، در غیر این صورت هیچ کسی چرایی تغییر مقدار پیش‌فرض را درک نخواهد کرد.

برای کد تحلیل داده‌ها، از توضیحات برای طرح کلی کدها استفاده کنید و بینش‌های مهم‌تان را هنگام مواجهه با آنها ثبت کنید. هیچ شیوه‌ی دیگری برای کسب این دانش به تنهایی از خود کد وجود ندارد.

## 3.2 نقش نام‌گذاری شئ‌ها
نام شئ‌ها بایستی با یک حرف شروع شوند و می‌توانند شامل حروف، اعداد، `_` و `.` باشند. شما می خواهید که نام شئ‌ها توصیفی باشند، بنابراین نیاز دارید شرایطی را برای چندین کلمه اتخاذ کنید. ما شیوه  **snake_case** را پیشنهاد می‌کنیم به طوری که کلمات با حروف کوچک با `_` از هم جدا می‌شوند.
```{r}
i_use_snake_case
otherPeopleUseCamelCase
some.people.use.periods
And_aFew.People_RENOUNCEconvention
```
دوباره به نام شئ‌ها در فصل 4 در زمان بحث درباره سبک نگارش کد باز خواهیم گشت.

می توانید با تایپ کردن نام یک شئ آن را بررسی کنید.
```{r}
x
#> [1] 12
```

شئ دیگری با عملگر تخصیص ایجاد کنید:
```{r}
this_is_a_really_long_name <- 2.5
```
برای نمایش یک شئ سعی کنید که از قابلیت تکمیل Rstudio استفاده کنید: کلمه "this" را تایپ کنید، دکمه TAB را بفشارید، کاراکترهایی را تا زمان رسیدن به یک ‍پیشوند یکتا اضافه کنید و سپس دکمه return را بفشارید.

فرض کنید که یک اشتباه ساخته‌اید، این که مقدار
`this_is_a_really_long_name`
باید 3.5 باشد و نه 2.5. می‌توانید از کلمات میان‌بر صفحه کلید برای اصلاح آن استفاده کنید. برای مثال، دکمه :arrow_up: را برای نشان دادن آخرین دستور بفشارید و سپس آن را ویرایش کنید. یا این که با تایپ کلمه "this" و فشردن 
 :arrow_up:+Cmd/Crtl
 تمامی دستوراتی را که تا الان تایپ  کرده‌اید و با این حروف شروع می‌شوند را فهرست می‌کند. از کلیدهای جهت‌نما برای پیدا کردن دستور قبلی استفاده کنید، سپس با زدن دکمه enter دستور را دوباره تایپ کنید. مقدار شئ را از 2.5 به 3.5 تغییر دهید و دوباره آن را اجرا کنید.

 یک شئ دیگر مانند زیر بسازید:
```{}
r_rocks <- 2^3
```
آن را نمایش دهید:
```{r}
r_rock
#> Error: object 'r_rock' not found
R_rocks
#> Error: object 'R_rocks' not found
```
این موضوع بیانگر قرارداد ضمنی بین شما و R است: R محاسبات خسته‌کننده را برایتان انجام می‌دهد اما در عوض شما بایستی دستورالعمل‌ها را کاملا دقیق انجام دهید. اگر غیر از این باشد، احتمالاً با خطا روبرو خواهید شد و نشان می‌دهد شئ‌ای که در جسجوی آن بوده‌اید، پیدا نشده است. غلط املایی مهم است: R نمی‌تواند ذهن شما را بخواند و این گونه تفسیر کند که منظور شما از تایپ `r_rock` همان `r_rocks` بوده است. حروف بزرگ و کوچک اهمیت دارند: به طور مشابه R نمی‌تواند ذهن شما را بخواند و این گونه تفسیر کند که منظور شما از `R_rocks` همان `r_rocks` بوده است.

 ## 4.2 فراخوانی توابع
 زبان R مجموعه‌ای بزرگی از توابع از پیش ساخته‌شده در خود دارد که به صورت زیر فراخوانی می‌شوند:
```{r}
function_name(argument1 = value1, argument2 = value2, ...)
```
در اینجا سعی می‌کنیم که از تابع `seq()` استفاده کنیم که یک دنباله منظم از اعداد می‌سازد، با کنکاش در آن ویژگی‌های مفیدتر از Rstudio یاد خواهیم گرفت. حروف `se` را تایپ کنید و سپس دکمه TAB را بفشارید. یک پنجره بازشو گزینه‌های ممکن را به شما نشان خواهد داد. تابع `seq()` را با تایپ حروف بیشتر (مثلاً `q`) به جهت جلوگیری از اشتباه انتخاب کنید یا این که با استفاده از کلیدهای جهت‌نما :arrow_up:/arrow_down: آن را انتخاب کنید. به راهنمای شناوری که ظاهر می‌شود توجه کنید به طوری که آرگومان‌ها و هدف تابع را نشان می‌دهد. اگر نیاز به کمک بیشتر داشتید، دکمه F1 را برای دیدن تمام جزئیات آن تابع در بخش help در پنل پایین سمت راست Rstudio بفشارید.

وقتی تابع مورد نظر خود را انتخاب کردید، دوباره دکمه TAB را بفشارید. Rstudio پرانتزهای باز `)` و بسته `(` را به آن اضافه خواهد کرد. نام نخستین آرگومان یعنی `from` را تایپ کنید و مقدار آن را برابر `1` قرار دهید. سپس، نام آرگومان دوم یعنی `to` را تایپ کنید و مقدار آن را 10 بگذارید. در نهایت دکمه return را بزنید.
```{r}
seq(from = 1, to = 10)
#>  [1]  1  2  3  4  5  6  7  8  9 10
```
در فراخوانی توابع اغلب نام نخستین چند آرگومان را حذف می‌کنیم، از این رو تابع به صورت زیر بازنویسی می‌گردد:
```{r}
seq(1, 10)
#>  [1]  1  2  3  4  5  6  7  8  9 10
```
کد زیر را تایپ کنید و توجه کنید که Rstudio کمک‌های مشابهی با علامت‌های نقل قول فراهم می‌کند:
```{r}
x <- "hello world"
```
علامت‌های نقل قول و پرانتزها همیشه باید به صورت یک جفت با هم تایپ شوند. Rstudio تمام تلاش خود را برای کمک به شما می کند، اما همیشه احتمال اشتباه و ناهمخوانی کاراکترها وجود دارد. در صورت چنین اتفاقی، R کاراکتر ادامه‌دهنده "+" را نشان خواهد داد:
```{.r, code-copy=false}
> x <- "hello
+
```
علامت `+` بیان می‌کند که R منتظر ورودی بیشتر است؛ نشان می‌دهد که هنوز کد کامل نشده است. معمولاً، این به معنای فراموشی یک کاراکتر مانند `"` و یا `(` است. یا جفت کاراکتر تایپ‌نشده را اضافه کنید، یا این که با فشردن دکمه  ESCAPE مانع اجرای کد شوید و دوباره تابع را تایپ کنید.

توجه داشته باشید که بخش environment در پنل بالا سمت راست تمام شئ‌هایی را که ایجاد کرده‌اید، نمایش می‌دهد:

![Alt text](Images/rstudio-env.png)

## 5.2 تمرینات
1. چرا کد زیر درست کار نمی‌کند؟
```{r}
my_variable <- 10
my_varıable
#> Error: object 'my_varıable' not found
```
به دقت نگاه کنید! (این ممکن است که تمرین بی‌هدفی به نظر برسد، اما ذهن شما را آموزش می‌دهد که در زمان برنامه‌نویسی کوچکترین تفاوت‌ها اثرگذار هستند.)

2. دستورات زیر در R را طوری تنظیم کنید که به درستی اجرا شوند:
```{r}
libary(todyverse)

ggplot(dTA = mpg) + 
  geom_point(maping = aes(x = displ y = hwy)) +
  geom_smooth(method = "lm)
```

3. کلیدهای ترکیبی Option + Shift + K / Alt + Shift + K را بفشارید. چه کاری انجام می‌دهند؟ با استفاده از منوها چگونه می‌توانید به همان مکان برسید؟
4. اجازه دهید به تمرینی از بخش 6.1 نگاهی دوباره بیاندازیم. خطوط کد زیر را اجرا کنید. کدام یک از دو نمودار با نام `mpg-plot.png` ذخیره شده است؟ چرا؟
```{r}
my_bar_plot <- ggplot(mpg, aes(x = class)) +
  geom_bar()
my_scatter_plot <- ggplot(mpg, aes(x = cty, y = hwy)) +
  geom_point()
ggsave(filename = "mpg-plot.png", plot = my_bar_plot)
```

## 6.2 چکیده
اکنون شما کمی یاد گرفته‌اید که R چطور کار می‌کند و برخی نکاتی که به شما کمک می‌کنند تا در زمان برگشت به کدتان در آینده آن را بفهمید. در فصل بعد، سفر علم داده را با آموزش بسته‌هایی مانند dplyr و tidyverse ادامه خواهیم داد به طوری که آنها در تبدیل داده‌ها، چگونگی انتخاب متغیرهای مهم، فیلتر کردن سطرهای مورد علاقه و یا محاسبه آمارهای خلاصه کمک می‌کنند.
